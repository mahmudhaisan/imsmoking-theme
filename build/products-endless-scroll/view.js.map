{"version":3,"file":"products-endless-scroll/view.js","mappings":"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","sources":["webpack://imsmoking-theme/./src/products-endless-scroll/view.js"],"sourcesContent":["(function () {\n  const containers = document.querySelectorAll('[data-product-endless-uid]');\n\n  containers.forEach(container => {\n    const grid = container.querySelector('.product-endless-grid');\n    const totalElem = container.querySelector('.pe-total');\n    let page = 1;\n    let loading = false;\n    let maxPages = Infinity;\n    const fetchedIDs = new Set();\n    const perPage = 12;\n\n    async function fetchProducts(initial = false) {\n      if (loading || page > maxPages) return;\n      loading = true;\n\n      const loader = document.createElement('div');\n      loader.className = 'loader';\n      loader.innerText = 'Loading products...';\n      if (!initial) grid.appendChild(loader);\n\n      try {\n        const res = await fetch(`/wp-json/wp/v2/product?per_page=${perPage}&page=${page}`);\n        if (!res.ok) {\n          if (res.status === 400) maxPages = page - 1;\n          throw new Error(`HTTP ${res.status}`);\n        }\n\n        maxPages = parseInt(res.headers.get('X-WP-TotalPages')) || maxPages;\n        const totalProducts = parseInt(res.headers.get('X-WP-Total')) || 0;\n        totalElem.innerText = `${totalProducts} products found`;\n\n        const products = await res.json();\n        if (!products.length) {\n          loading = false;\n          loader.remove();\n          return;\n        }\n\n        products.forEach(p => {\n          if (fetchedIDs.has(p.id)) return;\n          fetchedIDs.add(p.id);\n\n          const img = p.featured_media_url || 'https://via.placeholder.com/150';\n\n          const card = document.createElement('div');\n          card.className = 'product-card';\n          card.innerHTML = `\n            <img src=\"${img}\" alt=\"${p.title.rendered}\" />\n            <span>${p.title.rendered}</span>\n            <button class=\"add-to-cart-btn\" data-id=\"${p.id}\">Add to Cart</button>\n          `;\n\n          grid.appendChild(card);\n        });\n\n        // Add click event for add-to-cart buttons\n        grid.querySelectorAll('.add-to-cart-btn').forEach(btn => {\n          if (btn.dataset.bound) return;\n          btn.dataset.bound = true;\n\n          btn.addEventListener('click', async e => {\n            e.preventDefault();\n            const productId = btn.dataset.id;\n\n            btn.disabled = true;\n            btn.innerText = 'Adding...';\n\n            try {\n              const formData = new URLSearchParams();\n              formData.append('product_id', productId);\n              formData.append('quantity', 1);\n\n              const response = await fetch('/?wc-ajax=add_to_cart', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n                body: formData.toString()\n              });\n\n              if (response.ok) {\n                btn.innerText = 'Added!';\n\n                // ðŸ”„ Refresh both WooCommerce Blocks and legacy mini carts\n                try {\n                  // Modern WooCommerce Blocks mini cart refresh\n                  if (window.wp && wp.data && wp.data.dispatch) {\n                    const cartStore = wp.data.dispatch('wc/store/cart');\n                    if (cartStore && cartStore.invalidateResolutionForStore) {\n                      cartStore.invalidateResolutionForStore('getCart');\n                      console.log('Mini cart (block) refreshed');\n                    }\n                  }\n                } catch (e) {\n                  console.warn('WooCommerce Blocks cart refresh failed:', e);\n                }\n\n                // Legacy (classic) fragment refresh\n                if (typeof jQuery !== 'undefined') {\n                  jQuery(document.body).trigger('wc_fragment_refresh');\n                } else {\n                  const event = new Event('wc_fragment_refresh');\n                  document.body.dispatchEvent(event);\n                }\n\n                // Reset button after delay\n                setTimeout(() => {\n                  btn.innerText = 'Add to Cart';\n                  btn.disabled = false;\n                }, 1500);\n\n              } else {\n                btn.innerText = 'Error';\n                btn.disabled = false;\n              }\n\n            } catch (err) {\n              console.error(err);\n              btn.innerText = 'Error';\n              btn.disabled = false;\n            }\n          });\n        });\n\n        page++;\n        loading = false;\n        loader.remove();\n\n      } catch (err) {\n        console.error(err);\n        loader.remove();\n        loading = false;\n      }\n    }\n\n    // Load first batch\n    fetchProducts(true);\n\n    // Infinite scroll\n    window.addEventListener('scroll', () => {\n      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 300) {\n        fetchProducts();\n      }\n    });\n  });\n})();\n"],"names":["containers","document","querySelectorAll","forEach","container","grid","querySelector","totalElem","page","loading","maxPages","Infinity","fetchedIDs","Set","perPage","fetchProducts","initial","loader","createElement","className","innerText","appendChild","res","fetch","ok","status","Error","parseInt","headers","get","totalProducts","products","json","length","remove","p","has","id","add","img","featured_media_url","card","innerHTML","title","rendered","btn","dataset","bound","addEventListener","e","preventDefault","productId","disabled","formData","URLSearchParams","append","response","method","body","toString","window","wp","data","dispatch","cartStore","invalidateResolutionForStore","console","log","warn","jQuery","trigger","event","Event","dispatchEvent","setTimeout","err","error","innerHeight","scrollY","offsetHeight"],"sourceRoot":""}